# Documentation Technique : Licence 2N

## 1. Licence 2N

Link'nX est capable d'interagir avec les équipements 2N.  
En enregistrant au préalable un appareil 2N, il est possible d'envoyer et de recevoir des commandes telles que l'ouverture d'une porte ou le verrouillage d'un portail.

### 1.1 Ajouter une licence à la passerelle Link'nX

Diverses licences peuvent être ajoutées à votre projet pour enrichir les fonctionnalités de vos passerelles Link'nX.

1. Rendez-vous sur Can'nX, puis cliquez sur le bouton **"Ajouter une extension"** dans les options du projet contenant la Link'nX.
2. Saisissez la clé dans le champ et confirmez.

**Récupérer votre clé :**  
Afin de récupérer votre clé après un achat, il faut se rendre sur le site `www.can-nx.shop`, sur votre compte.  
Un bouton **"Clé de série"** vous permet d'afficher la liste des clés que vous avez achetées.

---

### 1.2 Configuration préalable de l'appareil 2N

Pour permettre à la Link'nX de communiquer avec l'appareil 2N, il est important de paramétrer correctement ce dernier.  
Accédez à l'interface en entrant l'adresse IP de l'appareil 2N dans l'URL d'un navigateur.  
Une fois connecté, dirigez-vous vers la page **"Services"**.

#### 1.2.1 Configuration du Service API HTTP

Link'nX et l'appareil 2N communiquent grâce au système d'API HTTP mis à disposition par 2N.  
Les services suivants doivent être activés (case cochée) :

* **API d'interrupteur :** Permet à la Link'nX d'envoyer des commandes vers l'appareil 2N afin de commander les interrupteurs.
* **API d'enregistrement :** Permet à la Link'nX de récupérer les événements qui se produisent sur l'appareil 2N (Entrée d'un code, appel, ouverture de porte, ...).

> **Note :** Chaque service peut choisir un protocole d'authentification (Aucun, Basic, Digest).  
> Cette information sera utile pour la Link'nX, car elle ne pourra pas communiquer si le protocole d'identification est différent.

#### 1.2.2 Configuration du Compte API HTTP

Un compte doit être paramétré, activé et doit avoir les privilèges utilisateurs utiles également activés.

**Privilèges recommandés :**
* Système  
* Téléphone/appels  
* Gestion de l'accès  
* Entrées et sorties  
* Interrupteurs  
* Audio  
* Caméra  
* Ecran  
* E-mail  
* UID (cartes et Wiegand)  
* Clavier  

---

### 1.3 Déclaration d'un appareil 2N

La déclaration d'un appareil 2N s'effectue dans la page dédiée à 2N.  
Pour y accéder, cliquez sur l'option "2N" dans le menu de navigation.

**Champs du formulaire :**

1. **Nom :** Nom de l'appareil 2N.  
2. **Adresse IP :** Adresse IP de l'appareil 2N.  
3. **Nom d'utilisateur :** Nom d'utilisateur du compte HTTP API (voir 1.2.2).  
4. **Mot de passe :** Mot de passe du compte HTTP API (voir 1.2.2).  
5. **Switch authentication method :** Méthode d'authentification pour le service "API d'interrupteur".  
6. **Log authentication method :** Méthode d'authentification pour le service "API d'enregistrement".  
7. **Import configuration :** Importation du fichier de configuration XML du 2N (téléchargeable depuis `Système` > `Maintenance` > `Enregistrer config`).  
   * *Note :* L'importation remplit automatiquement le Nom et l'IP et propose une auto-complétion pour les utilisateurs et les méthodes d'authentification.

Une fois enregistré, l'appareil apparaît dans la liste des 2N.

---

### 1.4 Création d'une action 2N

Pour créer une action 2N, naviguez vers la page "Action" et cliquez sur le bouton **"+ Ajouter"**.

**Champs du formulaire :**

1. **Type de l'action :** Sélectionner "2N".  
2. **Nom :** Nom de l'action 2N.  
3. **Appareil 2N :** Sélectionner l'appareil à contrôler.  
4. **Numéro d'élément :** Numéro d'interrupteur affecté par l'action.  
5. **Action :** Commande à effectuer (voir Annexes pour la liste).  
6. **Valider :** Enregistrer l'action 2N.

---

### 1.5 Création d'un déclencheur 2N

Pour créer un déclencheur 2N, naviguez vers la page "Déclencheur" et cliquez sur le bouton **"+ Ajouter"**.

**Champs du formulaire :**

1. **Type du déclencheur :** Sélectionner "2N".  
2. **Nom :** Nom du déclencheur.  
3. **Appareil 2N :** Appareil sur lequel récupérer les événements.  
4. **Évènement :** L'événement que la Link'nX doit surveiller (ex: Code entré).  
5. **Paramètres (Conditions) :** Facultatifs.  
   * Si vide : le déclencheur s'active à chaque réception de l'événement.  
   * Si spécifié : l'événement doit valider tous les paramètres pour activer le déclencheur (Ex: le code doit être exactement "1234").

---

## 2. Annexes

### 2.1 Liste des actions 2N

| Action | Description |
| :--- | :--- |
| **Ouvrir** | Active / ouvre l'interrupteur sélectionné. |
| **Fermer** | Désactive / ferme l'interrupteur sélectionné. |
| **Verrouiller** | Verrouille l'interrupteur (reste fermé et réagit seulement à "Déverrouiller"). |
| **Déverrouiller** | Permet un fonctionnement normal après un verrouillage. |
| **Maintenir la porte ouverte** | Place l'interrupteur dans un état 'maintenu' (ouvert). **Attention :** Vérifiez que la gâche supporte cet état sur la durée pour éviter les dommages. |
| **Relâcher l'ouverture maintenue** | Libère l'interrupteur de son état 'maintenu'. |

### 2.2 Liste des déclencheurs 2N

| Évènement | Description | Paramètres |
| :--- | :--- | :--- |
| **Changement d'état de l'appareil** | Signale les changements d'état (ex: démarrage). | *Aucun* |
| **Mouvement détecté** | Détection via caméra (si équipée et activée). | **État :** Début ou Fin de l'événement. |
| **Bruit détecté** | Augmentation du niveau de bruit (si activé). | **État :** Début ou Fin de l'événement. |
| **Code saisi** | Saisie d'un code via clavier numérique. | **Code saisi**, **Validité**, **ID Utilisateur**. |
| **Carte saisie** | Carte RFID tapée/posée. | **Validité**, **ID Utilisateur**. |
| **Entrée logique / Sortie logique modifiée** | Changement d'état d'une E/S. | **État logique**, **Nom du port E/S**. |
| **Changement d'état de l'interrupteur** | Interrupteur actif/inactif. | **Numéro**, **État**. |
| **Changement d'état de l'appel** | Connexion, Appel, Connecté, Terminé. | **Direction**, **État**. |
| **Interrupteur d'auto-protection activé** | Ouverture non autorisée du boîtier (Tamper). | **État**. |
| **Ouverture de porte non autorisée** | Nécessite un capteur d'ouverture. | **État**. |
| **Porte ouverte trop longtemps** | Nécessite un capteur d'ouverture. | **État**. |
| **Utilisateur authentifié** | Authentification et ouverture de porte réussies. | **Nom utilisateur**, **ID Utilisateur**. |
| **Carte maintenue (4s)** | Carte RFID maintenue > 4 secondes. | **ID du lecteur**, **Résultat**. |
| **Alarme silencieuse** | Alarme silencieuse ou bouton panique. | *Aucun* |
| **Bouton REX activé** | Activation du bouton poussoir de sortie. | *Aucun* |
| **Accès restreint** | Rejet de l'utilisateur. | *Aucun* |
| **Identification biométrique** | Doigt posé sur le lecteur. | **Validité**, **ID Utilisateur**. |
| **Clé mobile saisie** | Authentification Bluetooth. | **Validité**, **ID Utilisateur**. |
| **Code DTMF saisi** | Code tonalité durant un appel. | **Validité**. |
| **Changement d'état de la porte** | Porte ouverte/fermée. | **État**. |
| **Utilisateur rejeté** | Rejet de l'authentification. | **Motif**, **ID Utilisateur**. |
